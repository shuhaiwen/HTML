/*
* author: Lin Xiao Dong <1071322670@qq.com>
* update: 2019.03.29
* website: http://www.openwbs.com/
*/
function Admin_Class(){var a=this;this.debug=!1,this.about=function(){alert("About OpenWBS")},this.ajaxData="",this.ajax=function(a){var c=(a.me,a.async===!1?!1:!0),d=a.url,e=a.data,f=a.success,g=a.failed;a.failedMessageEcho===!0?!0:!1,$.ajax({type:"post",dataType:"html",async:c,url:d+"&return_type=json&r="+OW.random(),data:e,error:function(a,b,c){var d="",e="admin.ajax:error";Admin.debug&&OW.isNotNull(a.responseText)&&(d="<br>",d=d+"<b>textStatus</b>: "+b+"<br>",d=d+"<b>errorThrown</b>: "+c+"<br>",d=d+"<b>responseText</b>: "+a.responseText+"<br>",OWDialog({id:OW.createDialogID(),content:e+d}));try{g(e).call()}catch(f){}},success:function(a){var b,c,d,e='{"result":"failed","messages":[{"message":"'+escape("操作失败")+'"}]}';""==a&&(a=e);try{d=$.parseJSON(a)}catch(h){d=$.parseJSON(e)}if(Admin.ajaxData=d,"success"==d.result)f.call(this);else{for(c="",b=0;b<d.messages.length;b++)c=c+""+unescape(d.messages[b].message)+"<br>";Admin.debug&&(c=c+"<div class='server-data'>服务器返回信息：<br>"+a+"</div>");try{g(c).call()}catch(h){}}}})},this.clearCache=function(){var a=OWDialog().posting("正在清除缓存，请稍候...");Admin.ajax({async:!1,me:"",data:"",url:"index.asp?ctl=index&act=destop&subact=clear_cache&save=true",success:function(){a.success("缓存已清除完毕").timeout(1)},failed:function(b){a.error("缓存清除失败",b).timeout(3)}})},this.clearRemoteLink=function(){var b=OWDialog().loading("正在清除 ..."),c=$OWEditor.getContent();Admin.ajax({url:"index.asp?ctl=index&act=view_all&subact=clear_remote_link",data:"html="+escape(c),success:function(){b.success("清除完毕").timeout(2),c=unescape(Admin.ajaxData.html),$OWEditor.setContent(c)},failed:function(a){b.error("清除失败！",a).reset().timeout(3),$OWEditor.setContent(c)}})},this.createSummary=function(){var a=OWDialog().loading("正在提取摘要 ..."),b=$OWEditor.getContentTxt(),c=$("textarea[name='summary']");b=OW.rep(b,"&nbsp;"," "),b=OW.left(b,250),c.val(b),a.success("摘要提取完毕").timeout(2)},this.insertPageLabel=function(){$OWEditor.execCommand("inserthtml","_openwbs_page_break_tag_")},this.createUrlPath=function(a){var b=a.string,c=a.urlpath;$.ajax({type:"post",dataType:"html",async:!1,url:"../ow-includes/ow.pinyin.asp?cn_string="+escape(b)+"&r="+OW.random(),error:function(a,b,c){var d="";Admin.debug?(d="<br>",d=d+"<b>textStatus</b>: "+b+"<br>",d=d+"<b>errorThrown</b>: "+c+"<br>",d=d+"<b>responseText</b>: "+a.responseText+"<br>",OWDialog({id:OW.createDialogID(),content:"服务器开小差了，操作失败！"+d})):OWDialog({id:OW.createDialogID(),content:"服务器开小差了，操作失败！",timeout:4})},success:function(a){a=OW.left(a.replace(/[^0-9a-zA-Z\.\-\_]*/g,""),64),a=a.replace(/-/g,"_"),c.val(a)}})},this.dialogPosting=function(a){return OW.isNull(a)&&(a="正在提交并保存数据，请稍候..."),OWDialog({id:"d_owdialog_posting",content:'<div class="posting">'+a+"</div>"})},this.getRelated=function(a){var b=a.id,c=a.idName,d=a.title||"选择相关内容",e=a.titleName||"标题",f=a.related||$("#related");OWDialog({id:"d_get_related_list",title:d,iframe:a.url,padding:"0px",height:OW.dialogBigHeight(),width:OW.dialogBigWidth(),ok:function(){var j,k,l,m,n,a=this.dom.iframe,d=$(a.contentWindow.document.getElementById("data_list_area")),g=d.find("input[name='data-checkbox']:checked"),h=f.find("table"),i=h.find("tbody");return g.length>0&&(OW.isObjExist(h)||(h=$(document.createElement("table")).addClass("listTable"),i=$(document.createElement("tbody")),h.append('<thead><tr class="thead"><th>'+c+"</th><th>"+e+"</th><th>删除</th></tr></thead>"),h.append(i),f.append(h)),g.each(function(){j=$(this).val(),k=$(this).parent().parent().find("td[field='title']").attr("value"),l=$(this).parent().parent().find("td[field='title']").find("a").attr("href"),m=$(this).parent().parent().find("td[field='title']").find("img").attr("src"),n=$(this).parent().parent().find("td[field='title']").find(".goods-sn").html(),OW.isObjExist(h.find("input[name='related_"+c+"'][value='"+j+"']"))||j==b||(OW.isNotNull(m)?i.append('<tr class="data"><td>'+j+'<input type="hidden" name="related_'+c+'" value="'+j+'"></td><td><div class="ow-goods-item"><div class="thumb"><a href="'+l+'" target="_blank"><img src="'+m+'"></a></div><div class="info"><div class="title"><a href="'+l+'" name="title" target="_blank">'+k+'</a></div><div class="goods-sn">'+n+'</div></div></div></td><td><button type="button" name="delete" class="btn btn-small" onclick="$(this).parent().parent().delayRemove(200);">删除</button></td></tr>'):i.append('<tr class="data"><td>'+j+'<input type="hidden" name="related_'+c+'" value="'+j+'"></td><td><a target="_blank" href="'+l+'">'+k+'</a></td><td><button type="button" name="delete" class="btn btn-small" onclick="$(this).parent().parent().delayRemove(200);">删除</button></td></tr>'))})),!0},okValue:"确定",cancel:!0,cancelValue:"关闭"})},this.init=function(){$("#openwbs_help").click(function(){OWDialog({id:"d_openwbs_help",title:"使用帮助",iframe:"http://www.openwbs.com/doc/",padding:"0px 0px",height:OW.dialogBigHeight(),width:OW.dialogBigWidth()})}),(OW.webScreenWidth()<=680||OW.webScreenHeight()<=300)&&$("#openwbs_help").hide(),void 0==$("div.button-container").attr("class")&&$("body").css({padding:"0px 0px 0px 0px"}),$("#goback").click(function(){OW.goBack()}),Admin.goBackFixed(),$(window).scroll(function(){Admin.goBackFixed(),Admin.helpLineFixed()}),$("span.t-normal").hover(function(){$(this).addClass("hightLigth")},function(){$(this).removeClass("hightLigth")}),$("input[name='urlpath']").blur(function(){OW.onblur($(this),{rep:"/[^0-9a-zA-Z-_]*/g",length:64})})},this.runDisplay=function(){var a=$("div[name='display']").attr("result"),b=$("div[name='buttons']").find("a:first"),c=10;b.attr("default_text",b.html()),"success"==a&&(c=3),Admin.runDisplayTimeout(c),OW.enterClick(function(){OW.redirect($("div[name='buttons']").find("a:first").attr("href"))})},this.runDisplayTimeout=function(a){var b=$("div[name='buttons']").find("a:first"),c=b.attr("default_text")+' <i class="font-10 font-normal">('+a+")<i>";null!==a&&(3>=a&&b.html(c),a=parseInt(a-1),a>0?window.setTimeout(function(){Admin.runDisplayTimeout(a)},1e3):window.location.href=b.attr("href"))},this.showIpAddress=function(a,b){a.html("加载中..."),$.ajax({type:"get",async:!0,url:"http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js&ip="+b,dataType:"script",error:function(){a.html("IP地址加载失败")},success:function(){var c,d,e;try{c=remote_ip_info.country||"unknown",d=remote_ip_info.province||"unknown",e=remote_ip_info.city||"unknown"}catch(f){c="unknown",d="unknown",e="unknown"}address=c+" "+d+" "+e,a.html(""+address)}})},this.getIpAddress=function(a,b,c){$.ajax({type:"get",async:!0,url:"http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js&ip="+c,dataType:"script",error:function(){b.html('<a href="javascript:'+a+';">重载IP地址</a>')},success:function(){var c,d,e;try{c=remote_ip_info.country||"unknown",d=remote_ip_info.province||"unknown",e=remote_ip_info.city||"unknown"}catch(f){c="unknown",d="unknown",e="unknown"}address=c+" "+d+" "+e,b.html(""+address)}})},this.goBackFixed=function(){var b,a=$("#goback");void 0!==a&&(b=parseInt(document.documentElement.scrollTop)+OW.webScreenHeight()/2-parseInt(a.height())+5,a.css({top:b+"px"}))},this.goBackHide=function(){$("#goback").hide()},this.topAreaFixed=function(){var b,a=$("div.top-area");a&&(b=parseInt(OW.documentScrollTop()),b>24?a.addClass("transparent_95").css({position:"absolute",top:b-20,left:0,zIndex:10}):a.removeClass("transparent_95").css({position:"relative",top:"0px",zIndex:1}))},this.helpLineFixed=function(){var b,a=$("div.help-grid");a&&(b=parseInt(document.documentElement.scrollTop),b>1?a.addClass("transparent").css({position:"absolute",top:b-1,zIndex:11}):a.removeClass("transparent").css({position:"absolute",top:0,zIndex:1}))},this.copyright=function(){var a="_o_p_e_n_w_b_s_ _v_4_";alert(OW.rep(a,"_",""))},this.dataListTableInit=function(a){var b=OW.isNull(a.status_field)?"status":a.status_field,c=$("#delete_selected"),d=$("#data_list_area a[name='edit']"),e=$("#data_list_area a[name='delete']"),f=$("#select_all"),g=$("#data_list_area input[name='data-checkbox']"),h=$("#data_list_area tr.data"),i=$(".pages-style").find("a[name!='per-page']"),j=$("#data_list_area a[name='per-page']");$("#data_list_area tr:even").addClass("eline"),g.each(function(){var a=$(this).parent().next().attr("value");$(this).val(a),$(this).parent().parent().attr("value",a)}),f.click(function(){1==$(this).attr("checked")?(g.not("#data_list_area input:disabled").attr("checked",!0),h.not($("#data_list_area input:disabled").parent().parent()).addClass("selected")):(g.attr("checked",!1),h.removeClass("selected"))}).parent("th").css({padding:"0px 5px 0px 8px",width:"1%"}),g.click(function(){var a=$(this).parent().parent();1==$(this).attr("checked")?a.addClass("selected"):a.removeClass("selected")}).parent("td").css({padding:"0px 5px 0px 8px",width:"1%"}),i.click(function(){OW.pageLoading()}),j.click(function(){OW.cookie.setCookie($(this).attr("key"),$(this).attr("pagesize")),OW.refresh()}),$("#data_list_area td[field='sequence']").each(function(){var b=$(this).attr("value"),c=$(document.createElement("div")).addClass("list-order-cell"),d=$(document.createElement("a")).addClass("arrow-up").attr("title","升序"),e=$(document.createElement("a")).addClass("arrow-down").attr("title","降序"),f=$(document.createElement("input")).addClass("text list-order").val(b);d.click(function(){Admin.sequenceSetting({me:$(this),ctl:a.ctl,auxData:a.auxData,sequence:parseInt($(this).parent().parent("td").attr("value"))-1,id:$(this).parent().parent().parent("tr").attr("value")})}),e.click(function(){Admin.sequenceSetting({me:$(this),ctl:a.ctl,auxData:a.auxData,sequence:parseInt($(this).parent().parent("td").attr("value"))+1,id:$(this).parent().parent().parent("tr").attr("value")})}),f.change(function(){Admin.sequenceSetting({me:$(this),ctl:a.ctl,auxData:a.auxData,sequence:$(this).val(),id:$(this).parent().parent().parent("tr").attr("value")})}),$(this).empty().append(d).append(e).append(f).wrapInner(c)}),$("#data_list_area td[field='"+b+"']").each(function(){var b=a.auxData||"";""!=b&&(b="&"+b),Admin.attrValueSetting({td:$(this),value_0_Class:"status-0",value_0_Html:a.status_validValue,value_0_Title:a.status_validTitle,value_1_Class:"status-1",value_1_Html:a.status_invalidValue,value_1_Title:a.status_invalidTitle,ajaxURL:"index.asp?ctl="+a.ctl+"&act=edit&subact=status_edit&id="+$(this).parent("tr").attr("value")+b+"&save=true"})}),d.each(function(){var b=a.auxData||"";""!=b&&(b="&"+b),$(this).attr("href","?ctl="+a.ctl+"&act="+a.act_edit+"&id="+$(this).parent().parent().attr("value")+b)}),c.click(function(){var b=a.auxData||"";$("tr.selected").length>0?new OWDialog({id:OW.createDialogID(),content:a.delete_confirm,ok:function(){return Admin.listDataDeleting({ids:Admin.getSelectListData(),auxData:b,dialog:this,ctl:a.ctl,deleting:a.delete_doing,success:a.delete_success,success_callback:a.delete_success_callback,failed:a.delete_failed}),!1},cancel:!0,follow:$(this),close:!1}):(OWDialog({content:a.delete_tip,ok:!0,follow:$(this),shadow:!1,timeout:2}),f.attr("checked",!1),$("tr.data").each(function(){$(this).find("input[name='data-checkbox']").attr("checked",!1)}))}),e.click(function(){var b=$(this),c=$(this).parent().parent().attr("value"),d=$(this).parent().parent().find("td[field='"+a.field_name+"']").attr("value"),e=a.auxData||"";new OWDialog({id:OW.createDialogID(),content:a.delete_confirm2.replace("{tpl:name}"," <b>"+d+"</b> "),ok:function(){return Admin.listDataDeleting({me:b,ids:c,auxData:e,dialog:this,ctl:a.ctl,deleting:a.delete_doing,success:a.delete_success,success_callback:a.delete_success_callback,failed:a.delete_failed}),!1},cancel:!0,follow:b,close:!1})})},this.sequenceSetting=function(a){var b=Admin.dialogPosting(),c=a.auxData||"";""!=c&&(c="&"+c),Admin.ajax({me:a.me,url:"index.asp?ctl="+a.ctl+"&act=edit&subact=sequence_edit&id="+a.id+c+"&save=true",data:"sequence="+a.sequence,success:function(){OW.refresh()},failed:function(a){b.error("亲，很抱歉，排序失败，请查看以下错误信息",a).timeout(3)}})},this.attrValueSetting=function(a){var b=a.td,c=$(document.createElement("a"));0==OW.int(b.attr("value"))?c.addClass(a.value_0_Class).attr({href:"javascript:;",title:a.value_0_Title,value:0}).html(a.value_0_Html):c.addClass(a.value_1_Class).attr({href:"javascript:;",title:a.value_1_Title,value:1}).html(a.value_1_Html),b.empty().append(c),c.click(function(){c.removeClass().html('<span class="freshing"> ... </span>'),Admin.ajax({me:c,url:a.ajaxURL,data:b.attr("field")+"="+OW.iif(0==parseInt(c.attr("value")),1,0),success:function(){0==parseInt(c.attr("value"))?c.addClass(a.value_1_Class).attr({title:a.value_1_Title,value:1}).html(a.value_1_Html):c.addClass(a.value_0_Class).attr({title:a.value_0_Title,value:0}).html(a.value_0_Html)},failed:function(b){0==parseInt(c.attr("value"))?c.addClass(a.value_0_Class).attr({title:a.value_0_Title,value:0}).html(a.value_0_Html):c.addClass(a.value_1_Class).attr({title:a.value_1_Title,value:1}).html(a.value_1_Html),$dialog.error("亲，很抱歉，操作失败，请查看以下错误信息",b).timeout(3)}})})},this.listDataDeleting=function(a){var e,f,b=a.me||"",c=a.ids||"",d=a.auxData||"";""!=d&&(d="&"+d),e=a.success_callback||function(){},f=a.dialog,""!=c&&(f.content('<span class="loading">'+a.deleting+"</span>").button({id:"ok",remove:!0},{id:"cancel",disabled:!0}),Admin.ajax({me:b,url:"index.asp?ctl="+a.ctl+"&act=delete"+d,data:"ids="+c,success:function(){f.button({id:"cancel",remove:!0}).success(a.success).timeout(1).shadow(!1),c=c.split(",");var b;for(b=0;b<c.length;b++)$("tr.data[value="+c[b]+"]").delayRemove(600),e(c[b])},failed:function(b){f.button({id:"cancel",remove:!0}).error(a.failed,b).timeout(3)}}))},this.getSelectListData=function(){var a=$("tr.data input:checked").parent().parent(),b="";return a.each(function(){b=OW.iif(""==b,$(this).attr("value"),b+","+$(this).attr("value"))}),b},this.attachmentSelect=function(a){var b=a.btn,c=a.clear,d=a.input,e=a.filename,f=a.sitepath;b.click(function(){Admin.selectFiles({num:1,type:"url",sitepath:f,callback:function(){""!=Admin.selectFilesData&&(d.val(Admin.selectFilesData),OW.isObjExist(e)&&e.val(OW.filename(Admin.selectFilesData)))}})}),OW.isObjExist(c)&&c.click(function(){d.val(""),e.val("")})},this.attachmentSelect2=function(a){var b=$("input[name='"+a.inputName+"']");Admin.selectFiles({num:1,type:"url",sitepath:OW.sitePath,callback:function(){""!=Admin.selectFilesData&&b.val(Admin.selectFilesData)}})},this.fileSelect=function(a){var b=a.btn,c=a.clear,d=a.input,e=a.sitepath;b.click(function(){Admin.selectFiles({num:1,type:"url",sitepath:e,callback:function(){""!=Admin.selectFilesData&&d.val(Admin.selectFilesData)}})}),c.click(function(){d.val("")})},this.flashSelect=function(a){var b=a.btn,c=a.clear,d=a.input,e=a.box,f=a.sitepath;b.click(function(){Admin.selectFlashs({num:1,type:"url",sitepath:f,callback:function(){""!=Admin.selectFlashsData&&(d.val(Admin.selectFlashsData),e.empty().append('<embed src="'+Admin.selectFlashsData+'" quality="high" wmode="opaque" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash">'))}})}),d.blur(function(){var a=$.trim($(this).val());""!=a?e.empty().append('<embed src="'+a+'" quality="high" wmode="opaque" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash">'):e.empty()}),c.click(function(){d.val(""),e.empty()})},this.imageSelect=function(a){var b=a.btn,c=a.clear,d=a.input,e=a.imageBox,f=a.sitepath;b.click(function(){Admin.selectImages({num:1,type:"url",sitepath:f,callback:function(){""!=Admin.selectImagesData&&(d.val(Admin.selectImagesData),e.empty().append('<img src="'+Admin.selectImagesData+'" />'))}})}),d.blur(function(){var a=$.trim($(this).val());""!=a?e.empty().append('<img src="'+a+'" />'):e.empty().append('<img src="images/image.jpg" />')}),c.click(function(){d.val(""),e.empty().append('<img src="images/image.jpg" />')})},this.imagesSelect=function(a){var b,c,d,e,f,g,o,h=a.grid,i=h.find("button[name='select_images']"),j=h.find("ul"),k=a.sitepath,l=a.dataJSON,m=a.linkInputExist||!1,n='<li><div class="imgbox" name="imgbox"><img src="{$url}"></div><div class="url"><input type="text" class="text text-mini" name="image_url" placeholder="图片url" title="图片url" value="{$url}"></div><div class="name"><input type="text" class="text text-mini" name="image_name" placeholder="图片名称" title="图片名称" value="{$name}"></div>';if(m&&(n+='<div class="link"><input type="text" class="text text-mini" name="image_link" placeholder="图片链接" title="图片链接" value="{$link}"></div>'),n=n+'<div class="buttons"><button type="button" class="btn btn-mini mr5" name="move_ahead">&laquo;向前</button><button type="button" class="btn btn-mini mr5" name="change">更换</button><button type="button" class="btn btn-mini" name="delete">删除</button></div>'+"</li>",o=function(){h.find("input[name='image_url']").unbind("blur").blur(function(){var a=$(this).parent().siblings("div[name='imgbox']"),b=$.trim($(this).val());""!=b?a.empty().append('<img src="'+b+'" />'):a.empty()}),h.find("button[name='delete']").unbind("click").click(function(){$(this).parent().parent("li").delayRemove(100)}),h.find("button[name='move_ahead']").unbind("click").click(function(){var a=$(this).parent().parent(),b=a.prev();a.insertBefore(b)}),h.find("button[name='change']").unbind("click").click(function(){var a=$(this).parent().parent();Admin.selectImages({num:1,type:"url",sitepath:k,callback:function(){""!=Admin.selectImagesData&&(a.find("img").attr("src",Admin.selectImagesData),a.find("input[name='image_url']").val(Admin.selectImagesData),a.find("input[name='image_name']").val(OW.filename(Admin.selectImagesData,{exName:!1})))}})})},""!=l){try{g=$.parseJSON(l)}catch(p){g=$.parseJSON("{}")}for(b=0;b<g.length;b++)d=g[b].url,e=g[b].name,c=g[b].link||"",f=n.replace(/{\$url}/g,d).replace(/{\$name}/g,e).replace(/{\$link}/g,c),j.append(f);o()}i.click(function(){Admin.selectImages({num:100,type:"json",sitepath:k,callback:function(){if(""!=Admin.selectImagesData){for(g=$.parseJSON(Admin.selectImagesData),b=0;b<g.length;b++)d=g[b].url,e=OW.filename(d,{exName:!1}),c=g[b].link||"",f=n.replace(/{\$url}/g,d).replace(/{\$name}/g,e).replace(/{\$link}/g,c),j.append(f);o()}}})})},this.insertAttachment=function(a){Admin.selectFiles({num:50,type:"url",sitepath:OW.sitePath,callback:function(){a.call()}})},this.insertImages=function(a){Admin.selectImages({num:50,type:"url",sitepath:OW.sitePath,callback:function(){a.call()}})},this.saveRemoteImg=function(a){var b=OWDialog().loading("正在保存远程图片 ..."),c=$OWEditor.getContent(),d=a.folder;Admin.ajax({url:"index.asp?ctl=index&act=view_all&subact=save_remote_img",data:"folder="+d+"&html="+escape(c),success:function(){b.success("远程图片已保存到本地服务器").timeout(2),c=unescape(Admin.ajaxData.html),$OWEditor.setContent(c)},failed:function(a){b.error("操作失败！",a).reset().timeout(3),$OWEditor.setContent(c)}})},this.selectImagesData="",this.selectImages=function(a){var b=a.num||1,c=a.type||"url",d=a.sitepath||"/",e=a.callback||{},g=[],i="",j="";OWDialog({title:"选择图片",iframe:"index.asp?ctl=uploads&act=list&view_type=dialog&file_listtype=thumb",padding:"0px",height:OW.dialogBigHeight(),width:OW.dialogBigWidth(),ok:function(){var a,f=0,h=this.dom.iframe,k=$(h.contentWindow.document.getElementById("file_list")),l=k.find("dd.file[selected='selected']");switch(l.each(function(){if(a=$(this).attr("filepath"),OW.isImage(a)&&b>f){switch(c){case"url":g[f]=d+a;case"json":j='{"url":"'+d+a+'"}',i=""==i?j:i+","+j}f+=1}}),c){case"url":Admin.selectImagesData=g.join(","),e.call();break;case"json":Admin.selectImagesData="["+i+"]",e.call()}},okValue:"确定",cancel:!0,cancelValue:"关闭"})},this.selectFilesData="",this.selectFiles=function(a){var b=a.num||1,c=a.type||"url",d=a.sitepath||"/",e=a.callback||{},g=[],i="",j="";OWDialog({title:"选择文件",iframe:"index.asp?ctl=uploads&act=list&view_type=dialog&file_listtype=thumb",padding:"0px",height:OW.dialogBigHeight(),width:OW.dialogBigWidth(),ok:function(){var a,f=0,h=this.dom.iframe,k=$(h.contentWindow.document.getElementById("file_list")),l=k.find("dd.file[selected='selected']");switch(l.each(function(e){if(a=$(this).attr("filepath"),""!=a&&b>f){switch(c){case"url":g[e]=d+a;case"json":j='{"url":"'+d+a+'"}',i=""==i?j:i+","+j}f+=1}}),c){case"url":Admin.selectFilesData=g.join(","),e.call();break;case"json":Admin.selectFilesData="["+i+"]",e.call()}},okValue:"确定",cancel:!0,cancelValue:"关闭"})},this.selectFlashsData="",this.selectFlashs=function(a){var b=a.num||1,c=a.type||"url",d=a.sitepath||"/",e=a.callback||{},g=[],i="",j="";OWDialog({title:"选择文件",iframe:"index.asp?ctl=uploads&act=list&view_type=dialog&file_listtype=thumb",padding:"0px",height:OW.dialogBigHeight(),width:OW.dialogBigWidth(),ok:function(){var a,f=0,h=this.dom.iframe,k=$(h.contentWindow.document.getElementById("file_list")),l=k.find("dd.file[selected='selected']");switch(l.each(function(){if(a=$(this).attr("filepath"),OW.isFlash(a)&&b>f){switch(c){case"url":g[f]=d+a;case"json":j='{"url":"'+d+a+'"}',i=""==i?j:i+","+j}f+=1}}),c){case"url":Admin.selectFlashsData=g.join(","),e.call();break;case"json":Admin.selectFlashsData="["+i+"]",e.call()}},okValue:"确定",cancel:!0,cancelValue:"关闭"})},this.showHelpMsg=function(a,b){var c=b.title!==!1&&void 0!==b.title?b.title||"说明":!1,d=b.content||"",e=b.height||"",f=b.width!==!1&&void 0!==b.width?b.width||"":!1,g=$(a);OWDialog({id:OW.createDialogID(),title:c,content:d,height:e,width:f,padding:"10px",follow:g,shadow:!1})},this.OWRuntime=function(b){return b?$("#ow_runtime").html(b):null,a},this.SQLQueryNum=function(b){return b?$("#ow_sqlquerynum").html(b):null,a},this.update=function(){alert("暂时不需要升级")},this.pageTemplateInit=function(){var a=$("div[name='tpl']").find("button[name='use']"),b=$("div[name='tpl']").find("button[name='delete']");a.click(function(){var a=$(this).attr("foldername"),b=$(this).attr("is_mobile"),c=OWDialog().posting();Admin.ajax({me:"",data:"",url:"index.asp?ctl="+OW.ctl+"&act=add&tpl="+a+"&is_mobile="+b+"&save=true",success:function(){c.success("模板安装成功！").timeout(3),OW.refresh()},failed:function(a){c.error("亲，很抱歉，模板安装失败，请查看以下错误信息",a).timeout(3)}})}),b.click(function(){var a=$(this).attr("foldername"),b=$("div[tpl='"+a+"']"),c=new OWDialog({id:OW.createDialogID(),cancel:!0,close:!1,content:"模板删除后不可再恢复，您确定要删除此模板吗？",ok:function(){return this.posting("正在删除此模板 ... ").button({id:"ok",remove:!0},{id:"cancel",remove:!0}),Admin.ajax({me:"",data:"",url:"index.asp?ctl="+OW.ctl+"&act=delete&tpl="+a+"&save=true",success:function(){c.success("模板已成功删除！").timeout(2),OW.delay(2e3,function(){b.delayRemove(200)})},failed:function(a){c.error("亲，很抱歉，模板删除操作失败，请查看以下错误信息",a).timeout(3)}}),!1}})})},this.pagePluginsInit=function(){Admin.dataListTableInit({ctl:"plugins",act_edit:"edit",field_name:"plugin_name",status_validValue:"正常",status_validTitle:"点击可设置为已停用状态",status_invalidValue:"已停用",status_invalidTitle:"点击可设置为正常状态",delete_confirm:"卸载后应用将无法恢复，您确定要卸载吗？",delete_confirm2:"卸载后应用{tpl:name}将无法恢复，您确定要卸载吗？",delete_doing:"正在卸载应用...",delete_success:"应用卸载成功",delete_failed:"应用卸载失败",delete_tip:"请先选择您要卸载的应用"}),$("#data_list_area a[name='install']").click(function(){var a=$(this).attr("plugin"),b=$(this).parent().parent().find("td[field='plugin_name']").attr("value"),c=OWDialog({content:'<div class="posting">正在安装'+b+"，请稍候...</div>",follow:$(this),shadow:!1});Admin.ajax({me:"",data:"",url:"index.asp?ctl=plugins&act=add&plugin="+a+"&save=true",success:function(){c.success("安装成功").timeout(2),OW.refresh()},failed:function(a){c.error("安装失败",a).timeout(2)}})}),$("#data_list_area a[name='detail']").click(function(){var a=$(this).attr("plugin_code"),b=$(this).attr("plugin_url");$(this).parent().parent().find("td[field='plugin_name']").attr("value"),$(this).parent().parent().find("td[field='plugin_version']").attr("value"),OW.isNull(b)&&(b="http://www.openwbs.com/plugins/"+a+".html"),OW.openNewPage(b)})}}function Validate_Class(){this.input=function(a){var i,j,k,l,b=!0,c=a.me,d=a.tip,e=$.trim(c.val()),f=a.okValue||"",g=a.errorValue||"",h=$.trim(d.attr("default"));return""==h&&(h=$.trim(d.attr("htmlTips"))),""==h&&(h=$.trim(d.html())),h==g&&(h=""),c.val(e),i=a.test||{},j=i.re||"",k=i.reTips||"",""==e?(""==$.trim(d.attr("htmlTips"))&&(d.attr("default",h),d.attr("htmlTips",h)),d.removeClass("t-ok").addClass("t-err").html(g),c.focus(),b=!1):(j&&(l=new RegExp(j),l.test(e)||(d.removeClass("t-ok").addClass("t-err").html(k),c.focus(),b=!1)),b&&(""==f?d.removeClass("t-err").html(h):d.removeClass("t-err").addClass("t-ok").html(f))),b},this.select=function(a){var i,j,k,l,b=!0,c=a.me,d=a.tip,e=$.trim(c.val()),f=a.okValue||"",g=a.errorValue||"",h=$.trim(d.attr("default"));return""==h&&(h=$.trim(d.attr("htmlTips"))),""==h&&(h=$.trim(d.html())),h==g&&(h=""),i=a.test||{},j=i.re||"",k=i.reTips||"",""==e||0>=e?(""==$.trim(d.attr("htmlTips"))&&(d.attr("default",h),d.attr("htmlTips",h)),d.removeClass("t-ok").addClass("t-err").html(g),c.focus(),b=!1):(j&&(l=new RegExp(j),l.test(e)||(d.removeClass("t-ok").addClass("t-err").html(k),c.focus(),b=!1)),b&&(""==f?d.removeClass("t-err").html(h):d.removeClass("t-err").addClass("t-ok").html(f))),b},this.isURL=function(a){var b="^((https|http|ftp|rtsp|mms)?://)",c=new RegExp(b);return c.test(a)?!0:!1}}function Login_Class(){var a=this;this.loginFormSet=function(){var a=OW.webScreenHeight(),b=OW.webScreenWidth(),c=parseInt($("div.login-form").height()),d=parseInt($("div.login-form").width());a-20>c&&$("div.login-form").css("margin-top",(a-c)/2-48),b>d&&$("div.login-form").css("margin-left",(b-d)/2-48)},this.init=function(){a.loginFormSet(),window.onresize=function(){a.loginFormSet()};var b=OW.cookie.getCookie("last_login_admin")||"",c=$("input[name='username']"),d=$("input[name='password']"),e=$("input[name='verifycode_value']"),f=$("span[name='login_verifycode']");c.focus(),OW.isNull(b)?c.focus():(c.val(b),d.focus()),e.focus(function(){OW.isNull(f.html())&&OW.verifyCode({boxer:f})}),e.blur(function(){$(this).val(OW.parseVerifyCode($(this).val()))})},this.logining=function(){OW.parseFormInputValue({form:$("div.login-form")});var a=!0,b=$("input[name='username']"),c=$("input[name='password']"),d=$("input[name='verifycode_value']"),e=$("input[name='verifycode_name']"),f=$("span[name='login_verifycode']"),g=$("#login_button"),h=g.html(),i=OW.parseUsername(b.val()),j=OW.trim(c.val()),k=e.val(),l=d.val();return b.val(i),OW.cookie.setCookie("last_login_admin",i),1==g.attr("disabled")?!1:V.input({me:b,tip:$("span[name='t_username']"),okValue:"",errorValue:"请填写管理员账号"})?V.input({me:c,tip:$("span[name='t_password']"),okValue:"",errorValue:"请填写登陆密码"})?V.input({me:d,tip:$("span[name='t_verifycode_value']"),okValue:"",errorValue:"请填写验证码"})?(a&&(i=OW.encrypt.encode(i),j=OW.encrypt.encode(j),g.attr("disabled",!0).html("登陆中..."),Admin.ajax({me:"",url:"index.asp?ctl=login&act=login",data:"username="+i+"&password="+j+"&verifycode_name="+k+"&verifycode_value="+l,success:function(){g.html("登陆成功，正在进入系统..."),window.location.href="index.asp"},failed:function(a){OW.verifyCode({boxer:f}),OWDialog({beforeClose:function(){return g.attr("disabled",!1).html(h),!0}}).error("亲，很抱歉，登录错误，请查看错误信息！",a).positon().timeout(3)}})),void 0):(a=!1,d.focus(),!1):(a=!1,c.focus(),!1):(a=!1,b.focus(),!1)}}var Admin=new Admin_Class,V=new Validate_Class;