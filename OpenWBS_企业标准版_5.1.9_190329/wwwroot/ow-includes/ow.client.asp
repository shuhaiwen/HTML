<!--#include file="ow.os.asp"-->
<%:dim Client:set Client = new Client_Class:class Client_Class:public actionLink,actionMsg,errorLink,errMsg,ajaxJSON,auxJSON:public iI,oRs:private sub class_initialize():end sub:public sub init():call OS.init():end sub:private sub class_terminate():set OS = nothing:end sub:public function ajaxValid():if OW.validClientPost() then:ajaxValid = true:else:ajaxValid = false:end if:end function:public function ajaxError():ajaxJSON = "{""result"":""error"",""message"":"""& OW.escape(OS.lang(210)) &""""& OW.iif(auxJSON<>"",","& auxJSON,"") &"}":echo ajaxJSON:end function:public function ajaxFailed(byval msg):ajaxJSON = "{""result"":""failed"",""message"":"""& OW.escape(msg) &""""& OW.iif(auxJSON<>"",","& auxJSON,"") &"}":end function:public function ajaxSuccess(byval msg):ajaxJSON = "{""result"":""success"",""message"":"""& OW.escape(msg) &""""& OW.iif(auxJSON<>"",","& auxJSON,"") &"}":end function:public function ajaxFinishRun():echo ajaxJSON:end function:public function actionLinks(byval links):dim i,arr,s:if isArray(links) then:for i=0 to ubound(links):arr = split(links(i),">"):s = s & "<a class=""btn"& OW.iif(i=0," btn-primary","") &""" href="""& arr(1) &""">"& arr(0) &"</a>":next:else:if links<>"" then:if instr(links,">")>0 then:arr = split(links,">"):s = "<a class=""btn btn-primary"" href="""& arr(1) &""">"& arr(0) &"</a>":else:s = "<a class=""btn btn-primary"" href="""& links &""">"& OS.lang(223) &"</a>":end if :else:s = "<a class=""btn btn-primary"" href=""javascript:OW.goBack();"">"& OS.lang(224) &"</a>":end if:end if:actionLinks = s:end function:public function errorSetting(byval msg):dim i:if OW.isArray(errMsg) then:i = ubound(errMsg) + 1:redim preserve errMsg(i) : errMsg(i) = msg:else:redim errMsg(0) : errMsg(0) = msg:end if:end function:public function errorDisplay():dim i,s,ss,sb,str : set sb = OW.stringBuilder():for i=0 to ubound(errMsg):s = s &"<li>"& errMsg(i) &"</li>":ss= OW.iif(ss="",errMsg(i),ss &";"& errMsg(i)):next:if OW.isMobile then:sb.append "<!DOCTYPE HTML>":sb.append "<html><head><meta charset=""UTF-8"">":sb.append "<title>"& OS.lang(220) &"</title>":sb.append "<meta name=""viewport"" content=""width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no""/>":sb.append "<meta name=""format-detection"" content=""telephone=no, email=no"">":sb.append "<meta name=""apple-mobile-web-app-title"" content="""& SITE_NAME &""" />":sb.append "<meta name=""generator"" content=""OpenWBS "& OW_VERSION &""" />":sb.append "<link rel=""stylesheet"" href="""& SITE_URL &"ow-content/css/mobile.ow.css"" />":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/mobile/jquery.js""></script>":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/mobile/ow.js""></script>":sb.append "<body>":sb.append "<div class=""error-display"" name=""display""><h3>"& OS.lang(220) &"</h3><ul>"& s &"</ul>"&"<div class=""buttons"" name=""buttons"">"& Client.actionLinks(errorLink) &"</div></div>":sb.append "</body>":sb.append "</html>":else:sb.append "<!DOCTYPE HTML>":sb.append "<html><head><meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"">":sb.append "<title>"& OS.lang(220) &"</title>":sb.append "<meta name=""generator"" content=""OpenWBS "& OW_VERSION &""" />":sb.append "<link rel=""stylesheet"" href="""& SITE_URL &"ow-content/css/pc.ow.css"" />":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/pc/jquery.js""></script>":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/pc/ow.js""></script>":sb.append "<body>":sb.append "<div class=""error-display"" name=""display""><h3>"& OS.lang(220) &"</h3><ul>"& s &"</ul>"&"<div class=""buttons"" name=""buttons"">"& Client.actionLinks(errorLink) &"</div></div>":sb.append "</body>":sb.append "</html>":end if:str = sb.toString() : set sb = nothing:call console.log("<span class=""text"">Client.errorDisplay</span><span class=""error"">"& ss &"</span>"):echo str:end function:public function actionSetting(byval msg):dim i:if OW.isArray(actionMsg) then:i = ubound(actionMsg) + 1:redim preserve actionMsg(i) : actionMsg(i) = msg:else:redim actionMsg(0) : actionMsg(0) = msg:end if:end function:public function actionDisplay():dim i,s,sb,str : set sb = OW.stringBuilder():for i=0 to ubound(actionMsg):s = s &"<li>"& actionMsg(i) &"</li>":next:if OW.isMobile then:sb.append "<!DOCTYPE HTML>":sb.append "<html><head><meta charset=""UTF-8"">":sb.append "<title>"& OS.lang(220) &"</title>":sb.append "<meta name=""viewport"" content=""width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no""/>":sb.append "<meta name=""format-detection"" content=""telephone=no, email=no"">":sb.append "<meta name=""apple-mobile-web-app-title"" content="""& SITE_NAME &""" />":sb.append "<meta name=""generator"" content=""OpenWBS "& OW_VERSION &""" />":sb.append "<link rel=""stylesheet"" href="""& SITE_URL &"ow-content/css/mobile.ow.css"" />":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/mobile/jquery.js""></script>":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/mobile/ow.js""></script>":sb.append "<body>":sb.append "<div class=""action-display"" name=""display""><h3>"& OS.lang(220) &"</h3><ul>"& s &"</ul>"&"<div class=""buttons"" name=""buttons"">"& Client.actionLinks(actionLink) &"</div></div>":sb.append "</body>":sb.append "</html>":else:sb.append "<!DOCTYPE HTML>":sb.append "<html><head><meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"">":sb.append "<title>"& OS.lang(220) &"</title>":sb.append "<meta name=""generator"" content=""OpenWBS "& OW_VERSION &""" />":sb.append "<link rel=""stylesheet"" href="""& SITE_URL &"ow-content/css/pc.ow.css"" />":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/pc/jquery.js""></script>":sb.append "<script type=""text/javascript"" src="""& SITE_URL &"ow-content/js/pc/ow.js""></script>":sb.append "<body>":sb.append "<div class=""action-display"" name=""display""><h3>"& OS.lang(220) &"</h3><ul>"& s &"</ul>"&"<div class=""buttons"" name=""buttons"">"& Client.actionLinks(actionLink) &"</div></div>":sb.append "</body>":sb.append "</html>":end if:str = sb.toString() : set sb = nothing:echo str:end function:public function fenxiaoRecommender(byval rid):rid = OW.int(rid):if rid=0 then:rid = OW.int(OW.getForm("get","rid")):if rid=0 then:rid = OW.getSubMatches(OW.getRealCurrentURL(),"rid=(\d+)")(0,0):end if:end if:if rid>0 then:call OW.Cookie.setCookie("rid",rid,14400):end if:end function:public function firewallIp():dim arr,i,ip,check : check = false:if OW.config("firewall_ip_open")=1 Then:ip = OW.getClientIP():arr= split(ip,"."):ip = "":for i=0 to ubound(arr):if check=true then exit for : end if:if arr(i)<>"" then:if i=0 then:ip = arr(i):else:ip = ip &"."& arr(i):end if:if OW.DB.isRecordExistsBySQL("SELECT * FROM "& DB_PRE &"firewall_ip WHERE ip='"& ip &"' or ip='"& ip &".'") then:check = true:end if:end if:next:end if:firewallIp = check:end function:public function getMemberGroupJSON():dim s,json:set oRs = OW.DB.getRecordBySQL("SELECT group_id,group_name,(select top 1 group_name from ["& DB_PRE &"member_group_sites] where group_id=a.group_id and site_id="& SITE_ID &") as group_name_sites,group_rank,group_point,group_icon,group_color FROM "& DB_PRE &"member_group a WHERE group_type=2 AND status=0 AND group_rank>0 ORDER BY group_rank ASC"):do while not(oRs.eof):V("group_id") = oRs("group_id"):if not OW.isNul(oRs("group_name_sites")) then:V("group_name") = oRs("group_name_sites"):else:V("group_name") = oRs("group_name"):end if:V("group_rank")  = oRs("group_rank"):V("group_point") = oRs("group_point"):V("group_color") = oRs("group_color"):V("group_icon")  = oRs("group_icon"):s = "{""group_id"":"""& V("group_id") &""",""group_name"":"""& V("group_name") &""",""group_rank"":"""& V("group_rank") &""",""group_point"":"""& V("group_point") &""",""group_color"":"""& V("group_color") &""",""group_icon"":"""& V("group_icon") &"""}":if json="" then:json = s:else:json = json &","& s:end if:oRs.movenext:loop:OW.DB.closeRs oRs:getMemberGroupJSON = "["& json &"]":end function:public function getBuyRecord(byval gid,byval recordTpl,byval psize,byval pagetpl):dim arr(2):psize = OW.int(psize):psize = OW.iif(psize>50,50,psize):if OS.isGoodsExist(gid) then:on error resume next:OW.Pager.currentPage = OW.int(OW.getForm("post","page")):OW.Pager.sql   = "select spec_value,goods_price,goods_amount,(select username from "& OW.DB.Table.member &" where uid=a.uid) as buyer,(select date_added from "& OW.DB.Table.orders &" where order_id=a.order_id) as [date] from "& DB_PRE &"order_goods a WHERE gid="& gid &" AND order_id in (select order_id from "& OW.DB.Table.orders &" where pay_status>0 AND "& OW.DB.auxSQL &") AND "& OW.DB.auxSQL &" ORDER BY id DESC":OW.Pager.pageSize    = psize:OW.Pager.pageTpl     = pagetpl:OW.Pager.pageUrl     = "javascript:OW.shop.getBuyRecord({$page});":OW.Pager.loopHtml    = recordTpl:OW.Pager.loopExecute = "if fieldName=""buyer"" then fieldValue = OW.anonymousName(fieldValue) else if fieldName=""goods_price"" then fieldValue = OW.parsePrice(fieldValue) end if":OW.Pager.run():if err then:err.clear:else:arr(0) = OW.Pager.count:arr(1) = OW.Pager.loopHtmls:arr(2) = OW.Pager.pageHtmls:end if:end if:getBuyRecord = arr:end function:public function getComment(byval gid,byval cmtTpl,byval psize,byval pagetpl):dim arr(2):psize = OW.int(psize):psize = OW.iif(psize>50,50,psize):if OS.isGoodsExist(gid) then:on error resume next:OW.Pager.currentPage = OW.int(OW.getForm("post","page")):OW.Pager.sql   = "select cmt_id,spec_value,cmt_uid,cmt_author,(select avatar from ["& OW.DB.Table.member &"] where uid=cmt_uid) as cmt_author_avatar,cmt_author_ip,(select date_added from ["& OW.DB.Table.orders &"] where order_id=a.order_id) as buy_date,cmt_date,cmt_type,cmt_content,reply_uid,(select avatar from ["& OW.DB.Table.member &"] where uid=reply_uid) as reply_author_avatar,reply_date,reply_content from "& DB_PRE &"goods_comment a where gid="& gid &" AND approved=1 AND "& OW.DB.auxSQL &" ORDER BY cmt_id DESC":OW.Pager.pageSize    = psize:OW.Pager.pageTpl     = pagetpl:OW.Pager.pageUrl     = "javascript:OW.shop.getComment({$page});":OW.Pager.loopHtml    = cmtTpl:OW.Pager.run():if err then:err.clear:else:arr(0) = OW.Pager.count:arr(1) = OW.Pager.loopHtmls:arr(2) = OW.Pager.pageHtmls:end if:end if:getComment = arr:end function:public function getConsultation(byval gid,byval cstTpl,byval psize,byval pagetpl):dim arr(2):psize = OW.int(psize):psize = OW.iif(psize>50,50,psize):if OS.isGoodsExist(gid) then:on error resume next:OW.Pager.currentPage = OW.int(OW.getForm("post","page")):OW.Pager.sql   = "select cst_id,cst_uid,cst_author,(select avatar from ["& OW.DB.Table.member &"] where uid=cst_uid) as cst_author_avatar,cst_author_email,cst_author_ip,cst_date,cst_type,cst_content,reply_uid,(select avatar from ["& OW.DB.Table.member &"] where uid=reply_uid) as reply_author_avatar,reply_date,reply_content from "& DB_PRE &"goods_consultation where gid="& gid &" AND approved=1 AND "& OW.DB.auxSQL &" ORDER BY cst_id DESC":OW.Pager.pageSize    = psize:OW.Pager.pageTpl     = pagetpl:OW.Pager.pageUrl     = "javascript:OW.shop.getConsultation({$page});":OW.Pager.loopHtml    = cstTpl:OW.Pager.run():if err then:err.clear:else:arr(0) = OW.Pager.count:arr(1) = OW.Pager.loopHtmls:arr(2) = OW.Pager.pageHtmls:end if:end if:getConsultation = arr:end function:public function formListHtml(byval formId):dim rs,formDataTable,formExist,username,urlpath,isDisplay,page,pagesize:dim i,arr,count,fields,field,name,fieldType,fieldsHtml,listTpl,filedTpl,replyTpl,tpls,filedTpls,replyTpls,html,url:dim a,c,l,f,s,ss,v,htmls,colspan,rsCount,pagesHTML,psArr:set rs = OW.DB.getRecordBySQL("SELECT [table],urlpath,display,pagesize,list_tpl,field_tpl,reply_tpl FROM "& DB_PRE &"form WHERE form_id="& formId &" AND is_shop=0 AND "& OW.DB.auxSQL &""):if not rs.eof then:formDataTable = OW.DB.Table.formPre & rs("table"):urlpath   = OW.rs(rs("urlpath")):isDisplay = OW.int(rs("display")):pagesize  = OW.int(rs("pagesize")):listTpl   = OW.dbDataDecode(rs("list_tpl")):filedTpl  = OW.dbDataDecode(rs("field_tpl")):replyTpl  = OW.dbDataDecode(rs("reply_tpl")):formExist = true:else:formExist = false:end if:OW.DB.closeRs rs:if not(formExist) or isDisplay=0 then:formListHtml = "":exit function:end if:arr = OW.DB.getFieldValueBySQL("SELECT field,field_name,field_type FROM "& DB_PRE &"form_field WHERE form_id="& formId &" AND display_in_client=1 AND "& OW.DB.auxSQL &"ORDER BY sequence"):if OW.isMultArray(arr) then:count = ubound(arr,2):redim field(count):redim name(count):redim fieldType(count):for i=0 to count:field(i)     = arr(0,i):name(i)= arr(1,i):fieldType(i) = arr(2,i):fields = fields &",["& arr(0,i) &"]":next:else:if arr(0)<>"" then:redim field(0):redim name(0):redim fieldType(0):field(0)     = arr(0):name(0)= arr(1):fieldType(0) = arr(2):fields = ",["& arr(0) &"]":else:redim field(-1):redim name(-1):redim fieldType(-1):end if:end if:set rs = OW.DB.getRecordBySQL("SELECT id,uid,(SELECT avatar FROM "& DB_PRE &"member WHERE uid=a.uid) as avatar,(SELECT username FROM "& DB_PRE &"member WHERE uid=a.uid) as username,ip,post_time"& fields &" FROM "& formDataTable &" a WHERE status=0 ORDER BY id DESC"):if not rs.eof then:if rs.recordCount>1 then rsCount = rs.recordCount else rsCount = 0 : end if:rs.pageSize = pagesize:page = OW.clng(OW.getForm("both","page")):if page>0 then:if page > rs.pageCount then:rs.absolutePage = rs.pageCount:else:rs.absolutePage = page:end if:end if:page = rs.absolutePage:for iI=1 to pagesize:if rs.eof then exit for : end if:username = OW.rs(rs("username")):username = OW.iif(username="",OS.lang(66),username):tpls = listTpl:tpls = OW.rep(tpls,"{\$vo:id}",OW.rs(rs("id"))):tpls = OW.rep(tpls,"{\$vo:uid}",OW.rs(rs("uid"))):tpls = OW.rep(tpls,"{\$vo:avatar}",OW.rs(rs("avatar"))):tpls = OW.rep(tpls,"{\$vo:username}",username):tpls = OW.rep(tpls,"{\$vo:post_time}",OW.rs(rs("post_time"))):fieldsHtml = "":for i=0 to ubound(field):v    = OW.rs(rs(field(i))):if fieldType(i)="attachment" and v<>"" then:v = "<a href="""& v &""" target=""_blank"">"& OS.lang(67) &"</a>":end if:tpls = OW.rep(tpls,"{\$field:"&field(i)&"}",v):filedTpls  = filedTpl:filedTpls  = OW.rep(filedTpls,"{\$field:name}",trim(name(i))):filedTpls  = OW.rep(filedTpls,"{\$field:value}",v):fieldsHtml = fieldsHtml & filedTpls:next:tpls = OW.rep(tpls,"{\$vo:fields_html}",fieldsHtml):replyTpls = replyTpl:if replyTpls<>"" then:arr = OW.DB.getFieldValueBySQL("SELECT id,post_time,content,(SELECT avatar FROM "& DB_PRE &"member WHERE uid=a.uid) as avatar FROM "& DB_PRE &"form_reply a WHERE form_id="& formId &" AND data_id="& rs("id") &" AND "& OW.DB.auxSQL &""):if arr(1)>0 then:tpls = OW.rep(tpls,"{\$reply:post_time}",OW.rs(arr(1))):tpls = OW.rep(tpls,"{\$reply:content}",OW.rs(arr(2))):tpls = OW.rep(tpls,"{\$reply:avatar}",OW.rs(arr(3))):replyTpls = OW.rep(replyTpls,"{\$reply:post_time}",OW.rs(arr(1))):replyTpls = OW.rep(replyTpls,"{\$reply:content}",OW.rs(arr(2))):replyTpls = OW.rep(replyTpls,"{\$reply:avatar}",OW.rs(arr(3))):else:tpls = OW.rep(tpls,"{\$vo:reply}",""):end if:end if:tpls = OW.rep(tpls,"{\$vo:reply}",replyTpls):html = html & tpls:rs.movenext:next:url = OW.urlRewrite("f2"):url = replace(url,"{$urlpath}",urlpath):if OW.isMobile then:pagesHTML = OW.Pager.createPages(url,page,rsCount,rs.pageCount,pagesize,"{prev}{current}{next}"):else:pagesHTML = OW.Pager.createPages(url,page,rsCount,rs.pageCount,pagesize,""):end if:pagesHTML = "<div class=""pager"">"& pagesHTML &"</div>":html = html & pagesHTML:end if:OW.DB.closeRs rs:formListHtml = html:end function:public function formPostHtml(byval formId):formPostHtml = OW.dbDataDecode(OW.DB.getFieldValueBySQL("SELECT post_html FROM "& DB_PRE &"form WHERE form_id="& formId &" AND is_shop=0 AND "& OW.DB.auxSQL &"")):end function:public function getFormFieldValue(byval field, byval fieldType, byval datasize):dim s,v,tmp:select case fieldType:case "text","select","textarea":s = OW.validClientDBData(OW.getForm("post",field),datasize):case "editor":s = OW.validClientDBData(OW.getForm("post",field),datasize):case "radio":s = OW.validClientDBData(OW.getForm("post",field),datasize):case "checkbox":for each tmp in request.form(field):v = tmp:s = OW.IIF(s="",v,s &","& v):next:s = OW.validClientDBData(s,datasize):case "number":s = OW.validClientDBData(OW.getForm("post",field),datasize):case "money":s = OW.parseMoney(OW.getForm("post",field)):case "datetime":s = OW.formatDateTime(OW.unEscape(OW.getForm("post",field)),0):case else:s = OW.validClientDBData(OW.getForm("post",field),datasize):end select:getFormFieldValue = s:end function:public function isNeedRedirectToBindMobilePage():if LOGINED and OW.config("is_user_mobile_open")=1 and OW.isNul(MOBILE) then:call redirect(SITE_URL &"ow-ucenter/regboot.asp?ctl=set_mob_and_pw"):end if:end function:public function isNeedBindMobile():if OW.int(OW.config("is_need_bind_mobile"))=1 then:call Client.isNeedRedirectToBindMobilePage():end if:end function:public function run():dim loginReturnUrl,currentURL,ready : ready = true:if OW.config("site_close")=1 Then:response.write(OW.config("site_close_html")):exit function:end if:if firewallIp then:response.write(OS.lang(233)):ready = false:end if:if CTL="login" or CTL="reg" or CTL="content" or CTL="coupon" or CTL="cart" or CTL="order" or CTL="form" or CTL="store" then:if CTL="coupon" or CTL="cart" or CTL="form" then:loginReturnUrl = OW.currentURL():else:loginReturnUrl = OW.getReferer():end if:if loginReturnUrl="" then:loginReturnUrl = OW.getRealCurrentURL():end if:loginReturnUrl = OW.reps(loginReturnUrl,"&rid=","?rid="):if not(LOGINED) and OW.isWeixinAgent and OW.config("is_weixin_mobile_open")=1 then:if OW.config("is_fenxiao_open")=1 then:currentURL = OW.getRealCurrentURL():if OW.indexOf(currentURL,"rid=")>0 then:V("fenxiao_rid") = OW.getSubMatches(currentURL,"rid=(\d+)")(0,0):call Client.fenxiaoRecommender(V("fenxiao_rid")):end if:end if:call OW.setLoginReturnUrl(loginReturnUrl):call redirect(SITE_URL &"ow-includes/module/login/weixin/"):end if:end if:if ready then:call runTpl():end if:end function:public function runTpl():Tpl.echoRunInfo = true:if CTL<>"login" and CTL<>"logout" and CTL<>"reg" and CTL<>"forget_password" and CTL<>"error404" then:call isNeedBindMobile():end if:if OS.versionType="x" then:select case CTL:case "content":call fenxiaoRecommender(0):call Client.createFenxiaoURL():call Tpl.runContentAndGoods(IS_CATE,ROOTPATH,URLPATH,CATE_ID,CID,OW_PAGE):case "forum":call fenxiaoRecommender(0):call Tpl.runForum(URLPATH,ID,OW_PAGE):case "login","logout","reg","forget_password":call Tpl.runLogReg():case "form":call fenxiaoRecommender(0):call Client.createFenxiaoURL():call Tpl.runForm():case "search":call fenxiaoRecommender(0):call Tpl.runSearch():case "tags":call fenxiaoRecommender(0):call Tpl.runTags(0):case "shop":call fenxiaoRecommender(0):call Client.createFenxiaoURL():call Tpl.runShop():case "store":call fenxiaoRecommender(0):call Tpl.runStore():case "brand":call fenxiaoRecommender(0):call Tpl.runBrand(IS_CATE,URLPATH,OW_PAGE):case "coupon":call fenxiaoRecommender(0):call Tpl.runCoupon(ID):case "gtags":call fenxiaoRecommender(0):call Tpl.runTags(1):case "cart":call Tpl.runCart():case "order":call Tpl.runOrder():case "error404":call Tpl.runError404():case else:call fenxiaoRecommender(0):call Tpl.runIndex():end select:else:select case CTL:case "content":call Tpl.runContentAndGoods(IS_CATE,ROOTPATH,URLPATH,CATE_ID,CID,OW_PAGE):case "forum":call Tpl.runForum(URLPATH,ID,OW_PAGE):case "login","logout","reg","forget_password":call Tpl.runLogReg():case "form":call Tpl.runForm():case "search":call Tpl.runSearch():case "tags":call Tpl.runTags(0):case "error404":call Tpl.runError404():case else:call Tpl.runIndex():end select:end if:Tpl.display():end function:public function validAuth(byval cateId):dim arr,groupName,rs,result,text:arr    = array(OS.lang(221) &">"& SITE_URL &"",""& OS.lang(225) &">javascript:OW.goBack();"):result = true:set rs = OW.DB.getRecordBySQL("SELECT * FROM "&DB_PRE &"category_member_auth WHERE cate_id="& cateId &" AND group_id="& GROUP_ID &" AND forbid=1 AND "& OW.DB.auxSQL &""):if not rs.eof then:result    = false:groupName = OS.getGroupName(GROUP_ID):text= replace(OS.lang(252),"{$groupname}",groupName):if not(LOGINED) then:text  = replace(OS.lang(253),"{$groupname}",groupName):arr   = array(OS.lang(222) &">"& OW.urlRewrite("l1") &"",""& OS.lang(225) &">javascript:OW.goBack();"):end if:end if:OW.DB.closeRs rs:if SPECIAL_GROUP_ID>0 then:set rs = OW.DB.getRecordBySQL("SELECT * FROM "&DB_PRE &"category_member_auth WHERE cate_id="& cateId &" AND group_id="& SPECIAL_GROUP_ID &" AND forbid=1 AND "& OW.DB.auxSQL &""):if rs.eof then:result = true:else:result = false:text   = replace(OS.lang(252),"{$groupname}",OS.getGroupName(SPECIAL_GROUP_ID)):end if:OW.DB.closeRs rs:end if:if not(result) then:Client.errorLink = arr:Client.errorSetting(text):Client.errorDisplay():end if:validAuth = result:end function:public function createFenxiaoURL():dim redirectURL:if OW.config("is_fenxiao_open")=1 then:redirectURL = OW.getRealCurrentURL():if OW.indexOf(redirectURL,"rid=")>0 then:V("fenxiao_rid") = OW.getSubMatches(redirectURL,"rid=(\d+)")(0,0):if UID=0 then:call Client.fenxiaoRecommender(V("fenxiao_rid")):else:if OS.isValidFenxiaoMember() and V("fenxiao_rid")<>UID&"" then:redirectURL = OW.reps(redirectURL,"rid="& V("fenxiao_rid"),"rid="& UID):call redirect(redirectURL):end if:end if:else:if OS.isValidFenxiaoMember() and UID>0 then:redirectURL = redirectURL &"?rid="& UID:call redirect(redirectURL):end if:end if:end if:end function:end Class:%>